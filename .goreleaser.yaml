# .goreleaser.yaml
version: 2
env:
  - GO111MODULE=on

before:
  hooks:
    - go mod tidy
    - go generate ./...

snapshot:
  version_template: "{{ incpatch .Version }}-next"

builds:
  - id: bestipTest
    binary: bestipTest
    env:
      - CGO_ENABLED=0
    targets:
      - windows_amd64
      - linux_amd64
      - linux_arm64
      - darwin_amd64
      - darwin_arm64

# archives:
#   - format: tar.gz
#     name_template: >-
#       {{ .ProjectName }}_
#       {{- title .Os }}_
#       {{- if eq .Arch "amd64" }}x86_64
#       {{- else if eq .Arch "386" }}i386
#       {{- else }}{{ .Arch }}{{ end }}
#       {{- if .Arm }}v{{ .Arm }}{{ end }}
#     format_overrides:
#       - goos: windows
#         format: zip
#     files:
#       - README.md
#       - LICENSE
#       - configs/*
#       - data/*

archives:
  - format: binary # è®¾ç½®æ ¼å¼ä¸º `binary`ï¼Œç›´æŽ¥è¾“å‡ºäºŒè¿›åˆ¶
    name_template: >-
      {{- if eq .Os "windows" -}}
        {{ .Binary }}
      {{- else -}}
        {{ .Binary }}_{{ title .Os }}_{{ if eq .Arch "amd64" }}x86_64{{ else }}{{ .Arch }}{{ end }}
      {{- end }}
checksum:
  name_template: "checksums.txt"

changelog:
  sort: asc # æŒ‰æäº¤æ—¶é—´å‡åºæŽ’åºï¼Œæœ€æ—©çš„æäº¤æ˜¾ç¤ºåœ¨æœ€å‰é¢
  use: github
  filters:
    exclude:
      - "^test(:|\\()" # æŽ’é™¤æµ‹è¯•ç›¸å…³æäº¤
      - "merge conflict" # æŽ’é™¤å†²çªåˆå¹¶è®°å½•
      - "^Merge (pull request|remote-tracking branch|branch)" # æŽ’é™¤åˆå¹¶è¯·æ±‚
      - "go mod tidy" # æŽ’é™¤ä¾èµ–æ¸…ç†æäº¤
      - "^æ›´æ–°æ–‡ä»¶"
      - "^æµ‹è¯•(:|\\()"

  groups:
    # feat(UI): æ–°å¢žç”¨æˆ·ç™»å½•ç•Œé¢ã€æ–°å¢ž: å®žçŽ°ç”¨æˆ·è®¤è¯åŠŸèƒ½ã€‚
    # - title: "New Features" # â€œæ–°åŠŸèƒ½â€
    # - title: "âœ¨ New Features (æ–°åŠŸèƒ½)"
    - title: "{{ if .Env.USE_EMOJI }}âœ¨ New Features (æ–°åŠŸèƒ½){{ else }}New Features{{ end }}"
      regexp: '^(?i).*?(feat|åŠŸèƒ½|æ–°å¢ž|feature|æ–°ç‰¹æ€§)(\(.+\))??!?[-:\s].+$'
      order: 100


    # fix: ä¿®å¤UIç»„ä»¶åŠ è½½å»¶è¿Ÿé—®é¢˜
    # - title: "Bug fixes" # â€œBug ä¿®å¤â€
    # - title: "ðŸ› Bug Fixes (ä¿®å¤é—®é¢˜)"
    - title: "{{ if .Env.USE_EMOJI }}ðŸ› Bug Fixes (ä¿®å¤é—®é¢˜){{ else }}Bug fixes{{ end }}"
      regexp: '^(?i).*?(fix|ä¿®å¤|bug|é”™è¯¯|bugfix)(\(.+\))??!?[-:\s].+$'
      order: 200

    # config: æ›´æ–°çŽ¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ã€‚
    - title: "Config updates" # â€œé…ç½®æ›´æ–°â€
    # - title: "âš™ï¸ Config Updates (é…ç½®æ›´æ–°)"
      regexp: '^(?i).*?(config|é…ç½®|configuration)(\(.+\))??!?[-:\s].+$'
      order: 300

    # sec: ä¿®å¤ XSS æ¼æ´žï¼Œå¢žå¼ºå®‰å…¨ç­–ç•¥ã€‚
    - title: "Security updates" # â€œå®‰å…¨æ›´æ–°â€
    # - title: "ðŸ”’ Security Updates (å®‰å…¨æ›´æ–°)"
      regexp: '^(?i).*?(sec|å®‰å…¨|security)(\(.+\))??!?[-:\s].+$'
      order: 400

    # refactor: ä»£ç é‡æž„ï¼Œç‰ˆæœ¬æ›´æ–°ã€‚
    - title: "Code Refactor" # â€œä»£ç é‡æž„(æ—¢ä¸æ˜¯å¢žåŠ featureï¼Œä¹Ÿä¸æ˜¯ä¿®å¤bug)â€
    - title: "ðŸš€ Code Refactor (ä»£ç é‡æž„)"
      regexp: '^(?i).*?(refactor|é‡æž„|major|å¤§ç‰ˆæœ¬)(\(.+\))??!?[-:\s].+$'
      order: 500

    # pref: ä¼˜åŒ–ç”¨æˆ·ç™»å½•æµç¨‹ï¼Œå‡å°‘åŠ è½½æ—¶é—´ã€‚
    # - title: "Code Optimization" # â€œæ€§èƒ½ä¼˜åŒ–â€
    - title: "âš¡ï¸ Code Optimization (æ€§èƒ½ä¼˜åŒ–)"
      regexp: '^(?i).*?(perf?|performance|ä¼˜åŒ–|æ€§èƒ½|opt?|optimization)(\(.+\))??!?[-:\s].+$'
      order: 600

    # deps: æ›´æ–°ä¾èµ–åº“ç‰ˆæœ¬ï¼Œæå‡ç¨³å®šæ€§ã€‚
    - title: "Dependency updates" # â€œä¾èµ–æ›´æ–°â€
    # - title: "ðŸ“¦ Dependency Updates (ä¾èµ–æ›´æ–°)"
      regexp: '^(?i).*?(deps|ä¾èµ–|dependency)(\(.+\))??!?[-:\s].+$'
      order: 700

    # docs: æ›´æ–°APIä½¿ç”¨è¯´æ˜Žï¼Œæ·»åŠ ç¤ºä¾‹ä»£ç ã€‚
    - title: "Documentation updates" # â€œæ–‡æ¡£æ›´æ–°â€
    # - title: "ðŸ“ Documentation Updates (æ–‡æ¡£æ›´æ–°)"
      regexp: '^(?i).*?(docs?|æ–‡æ¡£|è¯´æ˜Ž|documentation|æ³¨é‡Š)(\(.+\))??!?[-:\s].+$'
      order: 800

    # i18n: æ·»åŠ è¥¿ç­ç‰™è¯­ç¿»è¯‘ï¼Œå®Œå–„å›½é™…åŒ–æ”¯æŒã€‚
    - title: "Translation updates" # â€œç¿»è¯‘æ›´æ–°â€
    # - title: "ðŸŒ Translation Updates (ç¿»è¯‘æ›´æ–°)"
      regexp: '^(?i).*?(local?|i18n|ç¿»è¯‘|localization|å›½é™…åŒ–|æœ¬åœ°åŒ–)(\(.+\))??!?[-:\s].+$'
      order: 900

    # ci(build): æ·»åŠ æŒç»­é›†æˆä»»åŠ¡ï¼Œè‡ªåŠ¨æž„å»ºå’Œå‘å¸ƒã€‚
    - title: "Build process updates" # â€œæž„å»ºè¿‡ç¨‹æ›´æ–°â€
    # - title: "ðŸ›  Build Process Updates (æž„å»ºè¿‡ç¨‹æ›´æ–°)"
      regexp: '^(?i).*?(build|ci|æž„å»º|æŒç»­é›†æˆ)(\(.+\))??!?[-:\s].+$'
      order: 1000

    # test: å¢žåŠ å•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–çŽ‡æå‡åˆ° 85%ã€‚
    - title: "Test-related" # â€œæµ‹è¯•ç›¸å…³â€
    # - title: "âœ… Test-Related(æµ‹è¯•ç›¸å…³)"
      regexp: '^(?i).*?(test|æµ‹è¯•|å•å…ƒæµ‹è¯•|é›†æˆæµ‹è¯•)(\(.+\))??!?[-:\s].+$'
      order: 1100

    # style: ä»£ç é£Žæ ¼ã€æ ¼å¼å˜åŠ¨ï¼ˆä¸å½±å“ä»£ç é€»è¾‘ï¼‰
    - title: "Style changes" # â€œæ ¼å¼å˜åŠ¨â€
    # - title: "ðŸŽ¨ Style Changes (æ ·å¼å˜æ›´)"
      regexp: '^(?i).*?(style|æ ·å¼|format|æ ¼å¼)(\(.+\))??!?[-:\s].+$'
      order: 1200

    # style: å›žæ»šæäº¤
    - title: "Revert commit" # â€œå›žæ»šæäº¤â€
    # - title: " ðŸ”™ revert commites (å›žæ»šæäº¤)"
      regexp: '^(?i).*?(revert|å›žæ»š)(\(.+\))??!?[-:\s].+$'
      order: 1300

    # chore: æ›´æ–°é¡¹ç›®æ–‡æ¡£ç´¢å¼•ï¼Œæ•´ç†æ–‡ä»¶ç»“æž„ã€‚
    - title: "Other work" # â€œå…¶ä»–å·¥ä½œâ€
    # - title: "ðŸ›  Other Work (å…¶ä»–å·¥ä½œ)"
      order: 9999

release:
  name_template: "v{{ .Version }} {{.TagSubject}}"

  replace_existing_artifacts: true
  mode: replace

  header: |

    **Latest Update:**

    > {{.TagContents}}

    Released in {{ .CommitDate }}

  footer: |
    **Full Changelog**: https://github.com/sinspired/ip-scanner/compare/{{ .PreviousTag }}...{{ if .IsNightly }}nightly{{ else }}{{ .Tag }}{{ end }}
