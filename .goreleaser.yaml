# .goreleaser.yaml
version: 2
env:
  - GO111MODULE=on

before:
  hooks:
    - go mod tidy
    - go generate ./...

snapshot:
  version_template: "{{ incpatch .Version }}-next"

builds:
  - id: bestipTest
    binary: bestipTest
    env:
      - CGO_ENABLED=0
    targets:
      - windows_amd64
      - linux_amd64
      - linux_arm64
      - darwin_amd64
      - darwin_arm64

# archives:
#   - format: tar.gz
#     name_template: >-
#       {{ .ProjectName }}_
#       {{- title .Os }}_
#       {{- if eq .Arch "amd64" }}x86_64
#       {{- else if eq .Arch "386" }}i386
#       {{- else }}{{ .Arch }}{{ end }}
#       {{- if .Arm }}v{{ .Arm }}{{ end }}
#     format_overrides:
#       - goos: windows
#         format: zip
#     files:
#       - README.md
#       - LICENSE
#       - configs/*
#       - data/*

archives:
  - format: binary # è®¾ç½®æ ¼å¼ä¸º `binary`ï¼Œç›´æ¥è¾“å‡ºäºŒè¿›åˆ¶
    name_template: >-
      {{- if eq .Os "windows" -}}
        {{ .Binary }}
      {{- else -}}
        {{ .Binary }}_{{ title .Os }}_{{ if eq .Arch "amd64" }}x86_64{{ else }}{{ .Arch }}{{ end }}
      {{- end }}
checksum:
  name_template: "checksums.txt"

changelog:
  sort: asc # æŒ‰æäº¤æ—¶é—´å‡åºæ’åºï¼Œæœ€æ—©çš„æäº¤æ˜¾ç¤ºåœ¨æœ€å‰é¢
  use: github
  filters:
    exclude:
      - "^test(:|\\()" # æ’é™¤æµ‹è¯•ç›¸å…³æäº¤
      - "merge conflict" # æ’é™¤å†²çªåˆå¹¶è®°å½•
      - "^Merge (pull request|remote-tracking branch|branch)" # æ’é™¤åˆå¹¶è¯·æ±‚
      - "go mod tidy" # æ’é™¤ä¾èµ–æ¸…ç†æäº¤
      - "^æ›´æ–°æ–‡ä»¶"
      - "^æµ‹è¯•(:|\\()"

  # æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼å’Œæ ‡é¢˜åˆ†ç»„æäº¤æ¶ˆæ¯
  #
  # é¡ºåºå€¼å®šä¹‰åˆ†ç»„é¡ºåº
  # æœªæä¾›æ­£åˆ™è¡¨è¾¾å¼æ„å‘³ç€æ‰€æœ‰æäº¤éƒ½å°†åˆ†ç»„åˆ°é»˜è®¤åˆ†ç»„ä¸‹
  #
  # åŒ¹é…ä»…å¯¹æäº¤æ¶ˆæ¯çš„ç¬¬ä¸€è¡Œæ‰§è¡Œï¼Œå‰ç¼€ä¸ºæäº¤ SHA1ï¼Œé€šå¸¸é‡‡ç”¨ `<abbrev-commit>[:] <title-commit>` å½¢å¼
  # å½“ä½¿ç”¨ github-native æ—¶ï¼Œåˆ†ç»„è¢«ç¦ç”¨ï¼Œå› ä¸ºå®ƒå·²ç»æŒ‰è‡ªèº«åˆ†ç»„
  # æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨ RE2 è¯­æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šhttps://github.com/google/re2/wiki/Syntax
  groups:
    # feat(UI): æ–°å¢ç”¨æˆ·ç™»å½•ç•Œé¢ã€æ–°å¢: å®ç°ç”¨æˆ·è®¤è¯åŠŸèƒ½ã€‚
    - title: "New Features" # â€œæ–°åŠŸèƒ½â€
    # - title: "âœ¨ New Features (æ–°åŠŸèƒ½)"
      regexp: '^(?i).*?(feat|åŠŸèƒ½|æ–°å¢|feature|æ–°ç‰¹æ€§)(\(.+\))??!?[-:\s].+$'
      order: 100


    # fix: ä¿®å¤UIç»„ä»¶åŠ è½½å»¶è¿Ÿé—®é¢˜
    - title: "Bug fixes" # â€œBug ä¿®å¤â€
    # - title: "ğŸ› Bug Fixes (ä¿®å¤é—®é¢˜)"
      regexp: '^(?i).*?(fix|ä¿®å¤|bug|é”™è¯¯|bugfix)(\(.+\))??!?[-:\s].+$'
      order: 200

    # config: æ›´æ–°ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ã€‚
    - title: "Config updates" # â€œé…ç½®æ›´æ–°â€
    # - title: "âš™ï¸ Config Updates (é…ç½®æ›´æ–°)"
      regexp: '^(?i).*?(config|é…ç½®|configuration)(\(.+\))??!?[-:\s].+$'
      order: 300

    # sec: ä¿®å¤ XSS æ¼æ´ï¼Œå¢å¼ºå®‰å…¨ç­–ç•¥ã€‚
    - title: "Security updates" # â€œå®‰å…¨æ›´æ–°â€
    # - title: "ğŸ”’ Security Updates (å®‰å…¨æ›´æ–°)"
      regexp: '^(?i).*?(sec|å®‰å…¨|security)(\(.+\))??!?[-:\s].+$'
      order: 400

    # refactor: ä»£ç é‡æ„ï¼Œç‰ˆæœ¬æ›´æ–°ã€‚
    - title: "Code Refactor" # â€œä»£ç é‡æ„(æ—¢ä¸æ˜¯å¢åŠ featureï¼Œä¹Ÿä¸æ˜¯ä¿®å¤bug)â€
    # - title: "ğŸš€ Code Refactor (ä»£ç é‡æ„)"
      regexp: '^(?i).*?(refactor|é‡æ„|major|å¤§ç‰ˆæœ¬)(\(.+\))??!?[-:\s].+$'
      order: 500

    # pref: ä¼˜åŒ–ç”¨æˆ·ç™»å½•æµç¨‹ï¼Œå‡å°‘åŠ è½½æ—¶é—´ã€‚
    - title: "Code Optimization" # â€œæ€§èƒ½ä¼˜åŒ–â€
    # - title: "âš¡ï¸ Code Optimization (æ€§èƒ½ä¼˜åŒ–)"
      regexp: '^(?i).*?(perf?|performance|ä¼˜åŒ–|æ€§èƒ½|opt?|optimization)(\(.+\))??!?[-:\s].+$'
      order: 600

    # deps: æ›´æ–°ä¾èµ–åº“ç‰ˆæœ¬ï¼Œæå‡ç¨³å®šæ€§ã€‚
    - title: "Dependency updates" # â€œä¾èµ–æ›´æ–°â€
    # - title: "ğŸ“¦ Dependency Updates (ä¾èµ–æ›´æ–°)"
      regexp: '^(?i).*?(deps|ä¾èµ–|dependency)(\(.+\))??!?[-:\s].+$'
      order: 700

    # docs: æ›´æ–°APIä½¿ç”¨è¯´æ˜ï¼Œæ·»åŠ ç¤ºä¾‹ä»£ç ã€‚
    - title: "Documentation updates" # â€œæ–‡æ¡£æ›´æ–°â€
    # - title: "ğŸ“ Documentation Updates (æ–‡æ¡£æ›´æ–°)"
      regexp: '^(?i).*?(docs?|æ–‡æ¡£|è¯´æ˜|documentation|æ³¨é‡Š)(\(.+\))??!?[-:\s].+$'
      order: 800

    # i18n: æ·»åŠ è¥¿ç­ç‰™è¯­ç¿»è¯‘ï¼Œå®Œå–„å›½é™…åŒ–æ”¯æŒã€‚
    - title: "Translation updates" # â€œç¿»è¯‘æ›´æ–°â€
    # - title: "ğŸŒ Translation Updates (ç¿»è¯‘æ›´æ–°)"
      regexp: '^(?i).*?(local?|i18n|ç¿»è¯‘|localization|å›½é™…åŒ–|æœ¬åœ°åŒ–)(\(.+\))??!?[-:\s].+$'
      order: 900

    # ci(build): æ·»åŠ æŒç»­é›†æˆä»»åŠ¡ï¼Œè‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒã€‚
    - title: "Build process updates" # â€œæ„å»ºè¿‡ç¨‹æ›´æ–°â€
    # - title: "ğŸ›  Build Process Updates (æ„å»ºè¿‡ç¨‹æ›´æ–°)"
      regexp: '^(?i).*?(build|ci|æ„å»º|æŒç»­é›†æˆ)(\(.+\))??!?[-:\s].+$'
      order: 1000

    # test: å¢åŠ å•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–ç‡æå‡åˆ° 85%ã€‚
    - title: "Test-related" # â€œæµ‹è¯•ç›¸å…³â€
    # - title: "âœ… Test-Related(æµ‹è¯•ç›¸å…³)"
      regexp: '^(?i).*?(test|æµ‹è¯•|å•å…ƒæµ‹è¯•|é›†æˆæµ‹è¯•)(\(.+\))??!?[-:\s].+$'
      order: 1100

    # style: ä»£ç é£æ ¼ã€æ ¼å¼å˜åŠ¨ï¼ˆä¸å½±å“ä»£ç é€»è¾‘ï¼‰
    - title: "Style changes" # â€œæ ¼å¼å˜åŠ¨â€
    # - title: "ğŸ¨ Style Changes (æ ·å¼å˜æ›´)"
      regexp: '^(?i).*?(style|æ ·å¼|format|æ ¼å¼)(\(.+\))??!?[-:\s].+$'
      order: 1200

    # style: å›æ»šæäº¤
    - title: "Revert commit" # â€œå›æ»šæäº¤â€
    # - title: " ğŸ”™ revert commites (å›æ»šæäº¤)"
      regexp: '^(?i).*?(revert|å›æ»š)(\(.+\))??!?[-:\s].+$'
      order: 1300

    # chore: æ›´æ–°é¡¹ç›®æ–‡æ¡£ç´¢å¼•ï¼Œæ•´ç†æ–‡ä»¶ç»“æ„ã€‚
    - title: "Other work" # â€œå…¶ä»–å·¥ä½œâ€
    # - title: "ğŸ›  Other Work (å…¶ä»–å·¥ä½œ)"
      order: 9999

release:
  name_template: "v{{ .Version }} {{.TagSubject}}"

  replace_existing_artifacts: true
  mode: replace

  header: |

    **Latest Update:**

    > {{.TagContents}}

    Released at {{ .CommitDate }}


  footer: |
    **Full Changelog**: https://github.com/sinspired/ip-scanner/compare/{{ .PreviousTag }}...{{ if .IsNightly }}nightly{{ else }}{{ .Tag }}{{ end }}
